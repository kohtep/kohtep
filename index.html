<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aleksandr B.</title>
  
  <link rel="icon" href="resources/icon/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="resources/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="resources/icon/favicon-16x16.png">
  <link rel="apple-touch-icon" href="resources/icon/apple-touch-icon.png">
  <link rel="manifest" href="resources/icon/site.webmanifest">

  <link rel="preload" as="image" href="resources/bg/background-2.avif" type="image/avif">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <section class="info-card slide-up" aria-labelledby="about-title">
    <header class="info-header">
      <h2 id="about-title">Aleksandr B.</h2>
      <div class="divider" aria-hidden="true"></div>
    </header>

    <div class="info-columns">
      <div class="info-col overview-col">
        <!--<h3 class="col-title">Overview</h3>-->
        <p>Software engineer focused on low-level development, reverse engineering, and system vulnerability research.</p>
        <p>Proficient in <strong>Delphi</strong>, <strong>C/C++</strong>, and <strong>x86/x64</strong> architectures.</p>
        <p>
          I also love 
          <span class="tooltip" data-tooltip="Tomoko Kuroki, Hitori Gotoh">social anxiety girls</span>
          and 
          <span class="tooltip" data-tooltip="Kikuri Hiroi">drunk anime bass women</span>.
        </p>
      </div>

      <div class="info-col profile-col">
        <picture>
          <source srcset="resources/pfp/pfp_tomoko.avif" type="image/avif">
          <source srcset="resources/pfp/pfp_tomoko.webp" type="image/webp">
          <img class="profile-media" src="resources/pfp/pfp_tomoko.jpg" alt="Profile media">
        </picture>

        <div class="social-icons">
          <a href="https://github.com/kohtep" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a>          
          <a href="https://t.me/kohtep" target="_blank" title="Telegram"><i class="fa-brands fa-telegram"></i></a>
          <a href="https://steamcommunity.com/profiles/76561198045711038" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a>
        </div>
      </div>
    </div>
    <div class="info-body">
      <div class="btn-row">
        <button type="button" class="btn btn-girls">My girls ✨</button>
      </div>
    </div>
  </section>

  <section class="placeholder-screen is-hidden" aria-labelledby="placeholder-title">
    <div class="placeholder-layout">
      <div class="char-col">
        <div class="char-stage"><!-- image injected dynamically --></div>
        <div class="char-grid">
          <div class="char-row char-row-1"></div>
          <div class="char-row char-row-2"></div>
          <div class="char-row char-row-3"></div>
          <div class="char-row char-row-4"></div>
        </div>
      </div>
      <!-- text block injected dynamically -->
    </div>

    <nav class="girls-strip" aria-label="Characters">
      <ul class="girls-list">
        <li>
          <button class="girl-btn" data-name="Kikuri Hiroi" data-character="kikuri">
            <img src="resources/girls/girls-previews/kikuri_hiroi.jpg" alt="Kikuri Hiroi" class="girl-thumb">
          </button>
        </li>
        <li>
          <button class="girl-btn" data-name="Tomoko Kuroki" data-character="tomoko">
            <img src="resources/girls/girls-previews/kuroki_tomoko.jpg" alt="Tomoko Kuroki" class="girl-thumb">
          </button>
        </li>
        <li>
          <button class="girl-btn" data-name="Hitori Gotoh" data-character="hitori">
            <img src="resources/girls/girls-previews/hitori_gotoh.jpg" alt="Hitori Gotoh" class="girl-thumb">
          </button>
        </li>
      </ul>
    </nav>
  </section>

  <script>
    const card = document.querySelector('.info-card');
    const placeholder = document.querySelector('.placeholder-screen');
    const body = document.body;

    const girlsBtn = document.querySelector('.info-card .btn-girls');
    const thumbButtons = [...document.querySelectorAll('.girl-btn')];

    let isTransitioning = false;
    let isSelectionLocked = false;
    let currentKey = null;
    let pendingKey = null;

    const CHARACTERS = {
      kikuri: {
        imageBase: 'resources/girls/kikuri_hiroi',
        fallbackExt: 'png',
        title: 'Kikuri Hiroi',
        subtitle: 'art by @schu_1112',
        meta: [
          ['Source','Bocchi the Rock!'],
          ['Age','25'],
          ['Birthday','September 28'],
          ['Height','158 cm'],
          ['Weight','43 kg'],
          ['Occupation','Bassist']
        ],
        paragraphs: [
          'My favorite drunk anime woman bassist. She has an extraordinary personality and an aura that makes you want to get absolutely wasted in her company and fall asleep cuddling together in your lonely apartment.',
          'When sober, she falls into depression and apathy due to numerous social problems that resurface in her mind as her self-reflection kicks in.',
          'Can I fix her? Haha, come on, I\'m kidding. Unless I\'m not... Haha, nah, just kidding... unless?..'
        ]
      },
      tomoko: {
        imageBase: 'resources/girls/kuroki_tomoko',
        fallbackExt: 'png',
        title: 'Tomoko Kuroki',
        subtitle: 'art by にしおと',
        meta: [
          ['Source','WataMote'],
          ['Age','15'],
          ['Birthday','February ??'],
          ['Height','148 cm'],
          ['Weight','41 kg'],
          ['Occupation','Student']
        ],
        paragraphs: [
          'My dearest insecure schoolgirl. Must be protected and spoiled.',
          'Her mix of outward uncertainty and an inner world full of sarcasm and cynicism is strangely captivating, and her clumsy attempts to fit into society evoke both affection and sadness at the same time.',
          'All in all, the perfect little sister.'
        ]
      },
      hitori: {
        imageBase: 'resources/girls/hitori_gotoh',
        fallbackExt: 'png',
        title: 'Hitori Gotoh',
        subtitle: 'art by kerorira',
        meta: [
          ['Source','Bocchi the Rock!'],
          ['Age','15'],
          ['Birthday','February 21'],
          ['Height','156 cm'],
          ['Weight','50 kg'],
          ['Occupation','Lead guitarist / Student']
        ],
        paragraphs: [
          'Another socially awkward girl who combines a rare mix of a very social skill - playing the guitar - with an inability to communicate normally with people.',
          'Hitori is a much more \'safe\' choice for the \'favorites\' category compared to Tomoko: she struggles with socialization, but her overall mindset is kinder and purer.',
          'In any case, that by no means makes her any worse, so she definitely belongs in my \'favorite imouto\' category.'
        ]
      }
    };

    function setCharacterPicture(pictureEl, data) {
      const sAvif = pictureEl.querySelector('.char-source-avif');
      const sWebp = pictureEl.querySelector('.char-source-webp');
      const img = pictureEl.querySelector('.char-image');
      if (data.imageBase) {
        const base = data.imageBase;
        const fbExt = data.fallbackExt || 'png';
        sAvif.srcset = `${base}.avif`;
        sWebp.srcset = `${base}.webp`;
        img.src = `${base}.${fbExt}`;
      } else if (data.images) {
        if (data.images.avif) sAvif.srcset = data.images.avif;
        if (data.images.webp) sWebp.srcset = data.images.webp;
        img.src = data.images.fallback;
      } else if (data.image) {
        img.src = data.image;
      }
      img.alt = data.title || '';
    }

    function forceReflow(el) { void el.offsetHeight; }

    function playIn(el) {
      el.classList.remove('is-hidden','leaving');
      el.classList.add('pre-enter');
      forceReflow(el);
      el.classList.add('appear');
      el.addEventListener('animationend', () => {
        el.classList.remove('appear','pre-enter');
      }, { once: true });
    }

    function playOut(el, onDone) {
      el.classList.remove('appear','pre-enter');
      el.classList.add('leaving');
      el.addEventListener('animationend', () => {
        el.classList.remove('leaving');
        el.classList.add('is-hidden');
        if (typeof onDone === 'function') onDone();
      }, { once: true });
    }

    document.addEventListener('click', (e) => {
      const back = e.target.closest('.btn-back');
      if (!back) return;

      if (!isTransitioning) {
        goHome();
      }
    });

    function openGirls() {
      if (card.classList.contains('is-hidden')) return;
      if (isTransitioning) return;
      isTransitioning = true;
      body.classList.add('bg-alt','show-girls');
      playOut(card, () => {
        playIn(placeholder);
        const firstBtn = document.querySelector('.girls-list .girl-btn');
        const firstKey = firstBtn?.dataset.character;
        if (!firstKey) { isTransitioning = false; return; }
        if (firstKey === currentKey) {
          setActiveThumbByKey(currentKey);
          isTransitioning = false;
          return;
        }
        renderCard(firstKey, true);
      });
    }

    function goHome() {
      if (placeholder.classList.contains('is-hidden')) return;
      if (isTransitioning) return;
      isTransitioning = true;
      pendingKey = null;
      isSelectionLocked = false;
      playOut(placeholder, () => {
        body.classList.remove('bg-alt','show-girls');
        playIn(card);
        isTransitioning = false;
      });
    }

    function setActiveThumbByKey(key) {
      document.querySelectorAll('.girls-list li').forEach(li => li.classList.remove('is-active'));
      document.querySelectorAll('.girl-btn').forEach(b => b.removeAttribute('aria-current'));
      const btn = document.querySelector(`.girl-btn[data-character="${key}"]`);
      if (!btn) return;
      const li = btn.closest('li');
      if (li) li.classList.add('is-active');
      btn.setAttribute('aria-current','true');
    }

    function renderCard(key, instant) {
      if (!CHARACTERS[key]) return;
      if (isTransitioning && !instant) return;
      if (key === currentKey) { isTransitioning = false; return; }
      isTransitioning = true;

      const data = CHARACTERS[key];
      const tpl = document.getElementById('tpl-card');
      const frag = tpl.content.cloneNode(true);

      const picture = frag.querySelector('.char-picture');
      setCharacterPicture(picture, data);

      const text = frag.querySelector('.placeholder-text');
      text.querySelector('.pt-title').textContent = data.title;
      text.querySelector('.pt-subtitle').textContent = data.subtitle;

      const meta = text.querySelector('.pt-meta');
      meta.innerHTML = '';
      data.meta.forEach(([k,v]) => {
        const row = document.createElement('div');
        row.className = 'pt-meta-row';
        const dt = document.createElement('dt'); dt.textContent = k;
        const dd = document.createElement('dd'); dd.textContent = v;
        row.appendChild(dt); row.appendChild(dd);
        meta.appendChild(row);
      });

      const paragraphs = text.querySelector('.pt-paragraphs');
      paragraphs.innerHTML = '';
      data.paragraphs.forEach(p => {
        const el = document.createElement('p');
        el.className = 'pt-body';
        el.textContent = p;
        paragraphs.appendChild(el);
      });

      const stage = document.querySelector('.char-stage');
      const oldVisual = stage.firstElementChild;
      const layout = document.querySelector('.placeholder-layout');
      const oldText = layout.querySelector('.placeholder-text');

      function finishTransition() {
        currentKey = key;
        isTransitioning = false;

        setActiveThumbByKey(key);

        if (pendingKey && pendingKey !== currentKey) {
          const next = pendingKey;
          pendingKey = null;
          isSelectionLocked = true;
          renderCard(next, false);
          return;
        }

        pendingKey = null;
        isSelectionLocked = false;
      }

      function animateIn(newVisualEl, newTextEl) {
        let waits = 0;
        let done = 0;

        if (newVisualEl) {
          stage.innerHTML = '';
          stage.appendChild(newVisualEl);
          if (!instant) {
            waits++;
            newVisualEl.classList.add('pre-enter');
            void newVisualEl.offsetHeight;
            newVisualEl.classList.add('appear');
            newVisualEl.addEventListener('animationend', () => {
              newVisualEl.classList.remove('appear','pre-enter');
              done++; if (done === waits) finishTransition();
            }, { once: true });
          }
        }

        if (newTextEl) {
          if (oldText && oldText.parentNode) {
            oldText.parentNode.replaceChild(newTextEl, oldText);
          } else {
            layout.appendChild(newTextEl);
          }
          if (!instant) {
            waits++;
            newTextEl.classList.add('pre-enter');
            void newTextEl.offsetHeight;
            newTextEl.classList.add('appear');
            newTextEl.addEventListener('animationend', () => {
              newTextEl.classList.remove('appear','pre-enter');
              done++; if (done === waits) finishTransition();
            }, { once: true });
          }
        }

        if (instant || waits === 0) finishTransition();
      }

      if (instant) {
        animateIn(picture, text);
        return;
      }

      const outTargets = [];
      if (oldVisual) outTargets.push(oldVisual);
      if (oldText) outTargets.push(oldText);

      if (!outTargets.length) {
        animateIn(picture, text);
        return;
      }

      let outDone = 0;
      outTargets.forEach(el => {
        el.classList.remove('appear','pre-enter','is-hidden');
        el.classList.add('leaving');
        el.addEventListener('animationend', () => {
          el.classList.remove('leaving');
          outDone++;
          if (outDone === outTargets.length) animateIn(picture, text);
        }, { once: true });
      });
    }

    function selectCharacter(btn) {
      const key = btn.dataset.character;
      if (!key) return;
      if (isSelectionLocked) return;

      if (isTransitioning) {
        pendingKey = key;
        isSelectionLocked = true;
        setActiveThumbByKey(key);
        return;
      }

      if (key === currentKey) return;

      isSelectionLocked = true;
      setActiveThumbByKey(key);

      if (card && !card.classList.contains('is-hidden')) {
        openGirls();
        placeholder.addEventListener('animationend', () => renderCard(key, true), { once: true });
        return;
      }

      renderCard(key, false);
    }

    if (girlsBtn) girlsBtn.addEventListener('click', openGirls);
    thumbButtons.forEach(btn => btn.addEventListener('click', () => selectCharacter(btn)));
  </script>

  <template id="tpl-card">
    <picture class="char-picture">
      <source class="char-source-avif" type="image/avif">
      <source class="char-source-webp" type="image/webp">
      <img class="char-image" alt="Character">
    </picture>
    <section class="placeholder-text">
      <h2 class="pt-title"></h2>
      <p class="pt-subtitle"></p>
      <dl class="pt-meta"></dl>
      <div class="pt-paragraphs"></div>
      <div class="btn-row">
        <button type="button" class="btn btn-back" aria-label="Back to home">← Back to home</button>
      </div>
    </section>
  </template> 
</body>
</html>
